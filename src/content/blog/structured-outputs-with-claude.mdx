---
title: "Notes on structured outputs with Claude"
description: "Practical patterns for extracting structured data from Claude API responses, including schema design and error handling."
publishDate: 2024-12-08
tags: ["AI", "Claude", "structured-output"]
draft: false
---

Working with structured outputs from language models requires careful consideration of schema design and validation.

## Defining output schemas

The foundation of reliable structured outputs is a well-defined schema that balances flexibility with constraint. Too rigid, and the model struggles to comply. Too loose, and you lose the benefits of structure.

## Validation strategies

Always validate the response structure before processing. Consider using Zod for runtime validation:

```typescript
import { z } from 'zod';

const ResponseSchema = z.object({
  intent: z.string(),
  confidence: z.number().min(0).max(1),
  entities: z.array(z.object({
    name: z.string(),
    type: z.string(),
  })),
});

const validated = ResponseSchema.parse(response);
```

This ensures your downstream code never encounters unexpected shapes.

## Error handling

When the model produces invalid output, you have several options for recovery:

- **Retry with feedback** - Tell the model what went wrong and ask again
- **Graceful degradation** - Fall back to a simpler extraction method
- **Partial parsing** - Extract what you can and mark the rest as uncertain

> The key is graceful degradation - always have a fallback path.

Each approach has trade-offs in terms of latency, cost, and reliability.
