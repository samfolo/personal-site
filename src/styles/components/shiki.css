/**
 * Code Block Styles
 *
 * Single source of truth for all code block styling:
 * - Syntax token definitions (global → theme → language)
 * - Shiki/Astro variable mapping
 * - Component layout and appearance
 * - Transformer support (diff, highlight, focus)
 *
 * Token cascade: :root defaults → .theme-* → .theme-* [data-language="*"]
 */

/* ==========================================================================
   1. TOKEN DEFINITIONS - Global Defaults

   Base syntax colours used when no theme is active.
   These are the fallback values for all tokens.
   ========================================================================== */

:root {
  /* Foundation - semantic names, colour descriptions in comments */
  --syn-bg: oklch(0.19 0.01 255.6);
  --syn-fg: var(--fg);
  --syn-link: var(--highlight);
  --syn-keyword: oklch(0.72 0.17 285);     /* violet */
  --syn-function: oklch(0.77 0.14 255);    /* blue */
  --syn-tag: oklch(0.72 0.17 285);         /* violet */
  --syn-string: oklch(0.72 0.13 150);      /* green */
  --syn-string-alt: oklch(0.70 0.13 130);  /* lime */
  --syn-constant: oklch(0.75 0.14 220);    /* cyan */
  --syn-number: oklch(0.78 0.12 180);      /* teal */
  --syn-type: oklch(0.75 0.12 195);        /* aqua */
  --syn-param: oklch(0.80 0.11 238);       /* sky */
  --syn-attr: oklch(0.82 0.10 238);        /* light - also variable, property */
  --syn-comment: oklch(0.52 0.02 255);     /* muted */
  --syn-punctuation: oklch(0.66 0.03 255); /* steel */
  --syn-escape: oklch(0.78 0.14 50);       /* coral - also selector */
  --syn-regexp: oklch(0.70 0.15 25);       /* rust */
  --syn-operator: var(--syn-fg);           /* operators default to foreground */

  /* Diff/highlight backgrounds & symbols */
  --syn-diff-add-bg: oklch(0.21 0.05 150);
  --syn-diff-remove-bg: oklch(0.21 0.05 25);
  --syn-diff-add-symbol: oklch(0.65 0.15 150);
  --syn-diff-remove-symbol: oklch(0.65 0.15 25);
  --syn-highlight-bg: oklch(0.22 0.01 255.6);

  /* Token mapping - passthrough to foundation */
  --shiki-foreground: var(--syn-fg);
  --shiki-background: var(--syn-bg);
  --shiki-token-keyword: var(--syn-keyword);
  --shiki-token-function: var(--syn-function);
  --shiki-token-constant: var(--syn-constant);
  --shiki-token-string: var(--syn-string);
  --shiki-token-string-expression: var(--syn-string-alt);
  --shiki-token-comment: var(--syn-comment);
  --shiki-token-punctuation: var(--syn-punctuation);
  --shiki-token-parameter: var(--syn-param);
  --shiki-token-link: var(--syn-link);
  --shiki-token-number: var(--syn-number);
  --shiki-token-unit: var(--syn-number);
  --shiki-token-operator: var(--syn-operator);
  --shiki-token-variable: var(--syn-attr);
  --shiki-token-type: var(--syn-type);
  --shiki-token-tag: var(--syn-tag);
  --shiki-token-attribute: var(--syn-attr);
  --shiki-token-property: var(--syn-attr);
  --shiki-token-property-value: var(--syn-constant);
  --shiki-token-selector: var(--syn-escape);
  --shiki-token-regexp: var(--syn-regexp);
  --shiki-token-escape: var(--syn-escape);

  /* Code block UI */
  --code-header-bg: oklch(from var(--rule) calc(l - 0.04) c h);
  --code-header-border: oklch(from var(--rule) calc(l + 0.05) c h);
  --code-overlay-border: oklch(from var(--rule) calc(l + 0.1) c h);
  --code-diff-add-bg: var(--syn-diff-add-bg);
  --code-diff-remove-bg: var(--syn-diff-remove-bg);
  --code-diff-add-symbol: var(--syn-diff-add-symbol);
  --code-diff-remove-symbol: var(--syn-diff-remove-symbol);
  --code-highlight-bg: var(--syn-highlight-bg);

  /* Focus mode */
  --code-focus-opacity: 0.3;
  --code-focus-hover-opacity: 0.7;
}

/* ==========================================================================
   2. TOKEN DEFINITIONS - Per-Theme

   Each theme overrides the tokens to match its colour palette.
   Only override tokens that differ from the global defaults.
   ========================================================================== */

/* --------------------------------------------------------------------------
   Steel Theme (blue-grey) - Primary hue: 255
   -------------------------------------------------------------------------- */
.theme-steel {
  /* Foundation - semantic names, colour descriptions in comments */
  --syn-bg: oklch(0.19 0.01 255.6);
  --syn-fg: var(--fg);
  --syn-keyword: oklch(0.7 0.03 275);        /* violet */
  --syn-function: oklch(0.7 0.06 253.64);    /* blue */
  --syn-tag: oklch(0.7 0.03 275);            /* violet */
  --syn-string: oklch(0.80 0.03 235);        /* sky */
  --syn-string-alt: oklch(0.6 0.09 255);     /* dusk */
  --syn-constant: oklch(0.80 0.03 235);      /* sky */
  --syn-number: oklch(0.75 0.09 47.3);       /* warm */
  --syn-type: oklch(0.9 0.03 235);           /* cloud */
  --syn-param: oklch(0.80 0.03 235);         /* sky */
  --syn-attr: oklch(0.9 0.03 235);           /* cloud */
  --syn-comment: oklch(0.6 0.01 47);         /* muted */
  --syn-punctuation: oklch(0.66 0.03 255);   /* steel */
  --syn-escape: oklch(0.75 0.1 75);          /* gold */
  --syn-regexp: oklch(0.70 0.15 25);         /* rust */

  /* Diff/highlight backgrounds */
  --syn-diff-add-bg: oklch(0.21 0.05 150);
  --syn-diff-remove-bg: oklch(0.21 0.05 25);
  --syn-highlight-bg: oklch(0.22 0.01 255.6);

  /* Token mapping - passthrough to foundation */
  --shiki-foreground: var(--syn-fg);
  --shiki-background: var(--syn-bg);
  --shiki-token-keyword: var(--syn-keyword);
  --shiki-token-function: var(--syn-function);
  --shiki-token-tag: var(--syn-tag);
  --shiki-token-string: var(--syn-string);
  --shiki-token-string-expression: var(--syn-string-alt);
  --shiki-token-constant: var(--syn-constant);
  --shiki-token-number: var(--syn-number);
  --shiki-token-unit: var(--syn-number);
  --shiki-token-type: var(--syn-type);
  --shiki-token-parameter: var(--syn-param);
  --shiki-token-attribute: var(--syn-attr);
  --shiki-token-comment: var(--syn-comment);
  --shiki-token-punctuation: var(--syn-punctuation);
  --shiki-token-variable: var(--syn-fg);
  --shiki-token-escape: var(--syn-escape);
  --shiki-token-regexp: var(--syn-regexp);
  --shiki-token-operator: var(--syn-operator);

  /* Code block UI */
  --code-diff-add-bg: var(--syn-diff-add-bg);
  --code-diff-remove-bg: var(--syn-diff-remove-bg);
  --code-highlight-bg: var(--syn-highlight-bg);
}

/* --------------------------------------------------------------------------
   Purple Theme - Primary hue: 300, Secondary: 97.89 (gold)
   -------------------------------------------------------------------------- */
.theme-purple {
  /* Foundation - semantic names, colour descriptions in comments */
  --syn-bg: oklch(0.2 0.02 303);
  --syn-fg: var(--fg);
  --syn-keyword: oklch(0.7 0.15 330);        /* magenta */
  --syn-function: oklch(0.8 0.05 280);       /* lavender */
  --syn-tag: oklch(0.72 0.17 285);           /* violet */
  --syn-string: oklch(0.8 0.05 97.89);       /* cream */
  --syn-string-alt: oklch(0.7 0.15 300);     /* purple */
  --syn-constant: oklch(0.8 0.05 97.89);     /* cream */
  --syn-number: oklch(0.8 0.1 40);           /* orange */
  --syn-type: oklch(0.7 0.15 300);           /* purple */
  --syn-param: oklch(0.8 0.01 0);            /* ash */
  --syn-comment: oklch(0.6 0.02 300);        /* muted */
  --syn-punctuation: oklch(0.8 0.01 0);      /* ash */
  --syn-escape: oklch(0.8 0.13 95);          /* gold */

  /* Diff/highlight backgrounds */
  --syn-diff-add-bg: oklch(0.21 0.05 154);
  --syn-diff-remove-bg: oklch(0.21 0.05 21);
  --syn-highlight-bg: oklch(0.22 0.02 303);

  /* Token mapping - passthrough to foundation */
  --shiki-foreground: var(--syn-fg);
  --shiki-background: var(--syn-bg);
  --shiki-token-keyword: var(--syn-keyword);
  --shiki-token-function: var(--syn-function);
  --shiki-token-tag: var(--syn-tag);
  --shiki-token-string: var(--syn-string);
  --shiki-token-string-expression: var(--syn-string-alt);
  --shiki-token-constant: var(--syn-constant);
  --shiki-token-number: var(--syn-number);
  --shiki-token-unit: var(--syn-number);
  --shiki-token-type: var(--syn-type);
  --shiki-token-parameter: var(--syn-param);
  --shiki-token-comment: var(--syn-comment);
  --shiki-token-punctuation: var(--syn-punctuation);
  --shiki-token-variable: var(--syn-fg);
  --shiki-token-escape: var(--syn-escape);
  --shiki-token-regexp: var(--syn-regexp);
  --shiki-token-operator: var(--syn-operator);

  /* Code block UI */
  --code-diff-add-bg: var(--syn-diff-add-bg);
  --code-diff-remove-bg: var(--syn-diff-remove-bg);
  --code-highlight-bg: var(--syn-highlight-bg);
}

/* --------------------------------------------------------------------------
   Charcoal Theme (neutral) - Warm hue: 60, minimal chroma
   -------------------------------------------------------------------------- */
.theme-charcoal {
  /* Foundation - semantic names, colour descriptions in comments */
  --syn-bg: oklch(0.19 0 0);
  --syn-fg: var(--fg);
  --syn-keyword: oklch(0.80 0.02 60);        /* chalk */
  --syn-function: oklch(0.86 0 0);       /* ash */
  --syn-tag: oklch(0.65 0.05 60);            /* chalk */
  --syn-string: oklch(0.80 0.01 70);         /* slate */
  --syn-string-alt: oklch(0.80 0.01 70);     /* stone */
  --syn-constant: oklch(0.77 0 0);       /* smoke */
  --syn-number: oklch(0.73 0.08 60);         /* smoke */
  --syn-type: oklch(1 0 0);                 /* smoke */
  --syn-param: oklch(0.77 0 0);          /* bone */
  --syn-attr: oklch(0.80 0.02 60);           /* bone */
  --syn-comment: oklch(0.48 0.01 60);        /* coal */
  --syn-punctuation: oklch(0.80 0.02 60);    /* graphite */
  --syn-escape: oklch(0.80 0.1 90);         /* chalk */

  /* Diff/highlight backgrounds & symbols */
  --syn-diff-add-bg: oklch(0.22 0.05 145);
  --syn-diff-remove-bg: oklch(0.22 0.05 20);
  --syn-diff-add-symbol: oklch(0.65 0.10 150);
  --syn-diff-remove-symbol: oklch(0.65 0.10 25);
  --syn-highlight-bg: oklch(0.22 0 0);

  /* Token mapping - passthrough to foundation */
  --shiki-foreground: var(--syn-fg);
  --shiki-background: var(--syn-bg);
  --shiki-token-keyword: var(--syn-keyword);
  --shiki-token-function: var(--syn-function);
  --shiki-token-tag: var(--syn-tag);
  --shiki-token-string: var(--syn-string);
  --shiki-token-string-expression: var(--syn-string-alt);
  --shiki-token-constant: var(--syn-constant);
  --shiki-token-number: var(--syn-number);
  --shiki-token-unit: var(--syn-number);
  --shiki-token-type: var(--syn-type);
  --shiki-token-parameter: var(--syn-param);
  --shiki-token-attribute: var(--syn-attr);
  --shiki-token-comment: var(--syn-comment);
  --shiki-token-punctuation: var(--syn-punctuation);
  --shiki-token-variable: var(--syn-fg);
  --shiki-token-escape: var(--syn-escape);
  --shiki-token-regexp: var(--syn-regexp);
  --shiki-token-operator: var(--syn-operator);

  /* Code block UI */
  --code-diff-add-bg: var(--syn-diff-add-bg);
  --code-diff-remove-bg: var(--syn-diff-remove-bg);
  --code-diff-add-symbol: var(--syn-diff-add-symbol);
  --code-diff-remove-symbol: var(--syn-diff-remove-symbol);
  --code-highlight-bg: var(--syn-highlight-bg);
}

/* --------------------------------------------------------------------------
   Teal Theme - Primary hue: 195, Secondary: 34 (coral)
   -------------------------------------------------------------------------- */
.theme-teal {
  /* Foundation - semantic names, colour descriptions in comments */
  --syn-bg: oklch(0.19 0.02 195.58);
  --syn-fg: oklch(0.84 0.01 214);
  --syn-keyword: oklch(0.66 0.05 34);       /* azure */
  --syn-function: oklch(0.84 0.01 214);      /* teal */
  --syn-tag: oklch(0.66 0.05 34);           /* azure */
  --syn-string: oklch(0.66 0.06 214);         /* coral */
  --syn-string-alt: oklch(0.66 0.06 214);     /* peach */
  --syn-constant: oklch(0.66 0.06 214);      /* cyan */
  --syn-number: oklch(0.73 0.06 128);        /* cyan */
  --syn-type: oklch(0.65 0.08 214);          /* cyan */
  --syn-param: oklch(0.80 0.05 214);         /* lime */
  --syn-attr: oklch(0.78 0.11 115);          /* lime */
  --syn-comment: oklch(0.50 0.03 195);       /* muted */
  --syn-punctuation: oklch(0.62 0.03 195);   /* steel */
  --syn-escape: oklch(0.8 0.1 90);         /* coral */
  --syn-operator: oklch(0.62 0.03 195);    /* steel */

  /* Diff/highlight backgrounds */
  --syn-diff-add-bg: oklch(0.22 0.06 150);
  --syn-diff-remove-bg: oklch(0.22 0.06 26);
  --syn-highlight-bg: oklch(0.23 0.02 195.73);

  /* Token mapping - passthrough to foundation */
  --shiki-foreground: var(--syn-fg);
  --shiki-background: var(--syn-bg);
  --shiki-token-keyword: var(--syn-keyword);
  --shiki-token-function: var(--syn-function);
  --shiki-token-constant: var(--syn-constant);
  --shiki-token-string: var(--syn-string);
  --shiki-token-string-expression: var(--syn-string-alt);
  --shiki-token-comment: var(--syn-comment);
  --shiki-token-punctuation: var(--syn-punctuation);
  --shiki-token-parameter: var(--syn-param);
  --shiki-token-variable: var(--syn-param);
  --shiki-token-type: var(--syn-type);
  --shiki-token-tag: var(--syn-tag);
  --shiki-token-attribute: var(--syn-attr);
  --shiki-token-escape: var(--syn-escape);
  --shiki-token-number: var(--syn-number);
  --shiki-token-unit: var(--syn-number);
  --shiki-token-regexp: var(--syn-regexp);
  --shiki-token-operator: var(--syn-operator);

  /* Code block UI */
  --code-diff-add-bg: var(--syn-diff-add-bg);
  --code-diff-remove-bg: var(--syn-diff-remove-bg);
  --code-highlight-bg: var(--syn-highlight-bg);
}

/* ==========================================================================
   3. VARIABLE MAPPING

   Maps --shiki-* tokens to Astro's --astro-code-* convention.
   Set on pre.astro-code so per-language overrides cascade correctly.
   ========================================================================== */

pre.astro-code {
  /* Core tokens */
  --astro-code-foreground: var(--shiki-foreground, var(--fg));
  --astro-code-background: var(--shiki-background, var(--rule));
  --astro-code-token-constant: var(--shiki-token-constant);
  --astro-code-token-string: var(--shiki-token-string);
  --astro-code-token-comment: var(--shiki-token-comment);
  --astro-code-token-keyword: var(--shiki-token-keyword);
  --astro-code-token-parameter: var(--shiki-token-parameter);
  --astro-code-token-function: var(--shiki-token-function);
  --astro-code-token-string-expression: var(--shiki-token-string-expression);
  --astro-code-token-punctuation: var(--shiki-token-punctuation);
  --astro-code-token-link: var(--shiki-token-link);

  /* Granular tokens (for custom TextMate theme) */
  --astro-code-token-number: var(--shiki-token-number);
  --astro-code-token-unit: var(--shiki-token-unit);
  --astro-code-token-operator: var(--shiki-token-operator);
  --astro-code-token-variable: var(--shiki-token-variable);
  --astro-code-token-type: var(--shiki-token-type);
  --astro-code-token-tag: var(--shiki-token-tag);
  --astro-code-token-attribute: var(--shiki-token-attribute);
  --astro-code-token-property: var(--shiki-token-property);
  --astro-code-token-property-value: var(--shiki-token-property-value);
  --astro-code-token-selector: var(--shiki-token-selector);
  --astro-code-token-regexp: var(--shiki-token-regexp);
  --astro-code-token-escape: var(--shiki-token-escape);
}

/* ==========================================================================
   4. PER-LANGUAGE-PER-THEME OVERRIDES

   Fine-tune tokens for specific languages within each theme.
   Only add overrides where needed - tokens inherit from theme defaults.

   Selector pattern: .theme-* pre.astro-code[data-language="*"]
   ========================================================================== */

/* --------------------------------------------------------------------------
   Steel Theme - Language Overrides
   All overrides reference --syn-* base colours, never --shiki-token-*
   -------------------------------------------------------------------------- */

.theme-steel pre.astro-code[data-language="css"] {
  --shiki-token-keyword: var(--syn-string);
  --shiki-token-variable: var(--syn-fg);
  --shiki-token-property: var(--syn-fg);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-operator: var(--syn-string);
  --shiki-token-selector: var(--syn-fg);
  --shiki-token-property-value: var(--syn-string);
  --shiki-token-function: var(--syn-function);
}

.theme-steel pre.astro-code[data-language="yaml"] {
  --shiki-token-constant: var(--syn-keyword);
}

.theme-steel pre.astro-code[data-language="python"] {
  --shiki-token-constant: var(--syn-keyword);
  --shiki-token-type: var(--syn-type);
}

.theme-steel pre.astro-code[data-language="rust"] {
  --shiki-token-constant: var(--syn-keyword);
}

.theme-steel pre.astro-code[data-language="go"] {
  --shiki-token-constant: var(--syn-keyword);
  --shiki-token-type: var(--syn-type);
}

.theme-steel pre.astro-code[data-language="json"] {
  --shiki-token-constant: var(--syn-keyword);
  --shiki-token-property: var(--syn-string);
}

.theme-steel pre.astro-code[data-language="html"] {
  --shiki-token-selector: var(--syn-fg);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-property: var(--syn-fg);
  --shiki-token-property-value: var(--syn-string);
}

.theme-steel pre.astro-code[data-language="xml"] {
  --shiki-token-selector: var(--syn-fg);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-property: var(--syn-fg);
  --shiki-token-property-value: var(--syn-string);
}

.theme-steel pre.astro-code[data-language="markdown"] {
  --shiki-token-keyword: var(--syn-fg);
  --shiki-token-link: var(--syn-string);
}

/* --------------------------------------------------------------------------
   Purple Theme - Language Overrides
   All overrides reference --syn-* base colours, never --shiki-token-*
   -------------------------------------------------------------------------- */

.theme-purple pre.astro-code[data-language="css"] {
  --shiki-token-keyword: var(--syn-string);
  --shiki-token-variable: var(--syn-fg);
  --shiki-token-property: var(--syn-fg);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-operator: var(--syn-string);
  --shiki-token-selector: var(--syn-fg);
  --shiki-token-property-value: var(--syn-string);
  --shiki-token-function: var(--syn-function);
}

.theme-purple pre.astro-code[data-language="yaml"] {
  --shiki-token-constant: var(--syn-tag);
}

.theme-purple pre.astro-code[data-language="python"] {
  --shiki-token-constant: var(--syn-tag);
  --shiki-token-type: var(--syn-function);
}

.theme-purple pre.astro-code[data-language="rust"] {
  --shiki-token-constant: var(--syn-tag);
}

.theme-purple pre.astro-code[data-language="go"] {
  --shiki-token-constant: var(--syn-tag);
  --shiki-token-type: var(--syn-function);
}

.theme-purple pre.astro-code[data-language="json"] {
  --shiki-token-constant: var(--syn-keyword);
  --shiki-token-property: var(--syn-string);
}

.theme-purple pre.astro-code[data-language="html"] {
  --shiki-token-selector: var(--syn-fg);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-property: var(--syn-fg);
  --shiki-token-property-value: var(--syn-string);
}

.theme-purple pre.astro-code[data-language="xml"] {
  --shiki-token-selector: var(--syn-fg);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-property: var(--syn-fg);
  --shiki-token-property-value: var(--syn-string);
}

.theme-purple pre.astro-code[data-language="markdown"] {
  --shiki-token-keyword: var(--syn-fg);
  --shiki-token-link: var(--syn-string);
}

/* --------------------------------------------------------------------------
   Charcoal Theme - Language Overrides
   -------------------------------------------------------------------------- */

.theme-charcoal pre.astro-code[data-language="css"] {
  --shiki-token-keyword: var(--syn-string);
  --shiki-token-variable: var(--syn-fg);
  --shiki-token-property: var(--syn-fg);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-operator: var(--syn-string);
  --shiki-token-selector: var(--syn-fg);
  --shiki-token-property-value: var(--syn-string);
  --shiki-token-function: var(--syn-function);
}

.theme-charcoal pre.astro-code[data-language="yaml"] {
  --shiki-token-constant: var(--syn-keyword);
}

.theme-charcoal pre.astro-code[data-language="python"] {
  --shiki-token-constant: var(--syn-keyword);
  --shiki-token-type: var(--syn-type);
}

.theme-charcoal pre.astro-code[data-language="rust"] {
  --shiki-token-constant: var(--syn-keyword);
}

.theme-charcoal pre.astro-code[data-language="go"] {
  --shiki-token-constant: var(--syn-keyword);
  --shiki-token-type: var(--syn-type);
}

.theme-charcoal pre.astro-code[data-language="json"] {
  --shiki-token-constant: var(--syn-keyword);
  --shiki-token-property: var(--syn-string);
}

.theme-charcoal pre.astro-code[data-language="html"] {
  --shiki-token-selector: var(--syn-fg);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-property: var(--syn-fg);
  --shiki-token-property-value: var(--syn-string);
}

.theme-charcoal pre.astro-code[data-language="xml"] {
  --shiki-token-selector: var(--syn-fg);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-property: var(--syn-fg);
  --shiki-token-property-value: var(--syn-string);
}

.theme-charcoal pre.astro-code[data-language="markdown"] {
  --shiki-token-keyword: var(--syn-fg);
  --shiki-token-link: var(--syn-string);
}

/* --------------------------------------------------------------------------
   Teal Theme - Language Overrides
   -------------------------------------------------------------------------- */

.theme-teal pre.astro-code[data-language="css"] {
  --shiki-token-keyword: var(--syn-string);
  --shiki-token-variable: var(--syn-param);
  --shiki-token-property: var(--syn-param);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-operator: var(--syn-operator);
  --shiki-token-selector: var(--syn-param);
  --shiki-token-property-value: var(--syn-string);
  --shiki-token-function: var(--syn-function);
}

.theme-teal pre.astro-code[data-language="yaml"] {
  --shiki-token-constant: var(--syn-keyword);
}

.theme-teal pre.astro-code[data-language="python"] {
  --shiki-token-constant: var(--syn-keyword);
  --shiki-token-type: var(--syn-type);
}

.theme-teal pre.astro-code[data-language="rust"] {
  --shiki-token-constant: var(--syn-keyword);
}

.theme-teal pre.astro-code[data-language="go"] {
  --shiki-token-constant: var(--syn-keyword);
  --shiki-token-type: var(--syn-type);
}

.theme-teal pre.astro-code[data-language="json"] {
  --shiki-token-constant: var(--syn-keyword);
  --shiki-token-property: var(--syn-string);
}

.theme-teal pre.astro-code[data-language="html"] {
  --shiki-token-selector: var(--syn-fg);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-property: var(--syn-fg);
  --shiki-token-property-value: var(--syn-string);
}

.theme-teal pre.astro-code[data-language="xml"] {
  --shiki-token-selector: var(--syn-fg);
  --shiki-token-attribute: var(--syn-string);
  --shiki-token-property: var(--syn-fg);
  --shiki-token-property-value: var(--syn-string);
}

.theme-teal pre.astro-code[data-language="markdown"] {
  --shiki-token-keyword: var(--syn-fg);
  --shiki-token-link: var(--syn-string);
}

/* ==========================================================================
   5. COMPONENT STYLES - Layout & Appearance
   ========================================================================== */

/* Code block wrapper - positioning context for label and copy button */
.code-block {
  position: relative;
  margin-top: var(--space-5);
  margin-bottom: var(--space-5);
}

/* Pre element base styles */
.prose :where(pre.astro-code):not(:where([class~="not-prose"], [class~="not-prose"] *)),
pre.astro-code {
  margin: 0;
  padding: 0;
  font-family: var(--font-mono);
  font-size: var(--text-sm);
  line-height: var(--leading-24);
  background-color: var(--astro-code-background) !important;
  color: var(--astro-code-foreground);
  border-radius: var(--space-2);
}

/* Code within pre - reset inherited styles */
pre.astro-code code {
  display: block;
  padding: calc(var(--space-6) + var(--space-2)) var(--space-5) var(--space-5);
  background: transparent;
  font-family: inherit;
  font-size: inherit;
  line-height: inherit;
  white-space: normal;
}

/* Individual lines - block display for proper wrapping */
pre.astro-code .line {
  display: block;
  min-height: var(--leading-24);
  white-space: pre-wrap;
}

/* --------------------------------------------------------------------------
   Floating Language Label
   -------------------------------------------------------------------------- */

.code-lang {
  position: absolute;
  top: var(--space-2);
  left: var(--space-2);
  padding: var(--space-1) var(--space-2);
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  color: var(--muted);
  line-height: var(--leading-16);
  z-index: var(--z-raised);
  pointer-events: none;
}

/* --------------------------------------------------------------------------
   Floating Copy Button
   -------------------------------------------------------------------------- */

.code-copy {
  position: absolute;
  top: var(--space-2);
  right: var(--space-2);
  padding: var(--space-1) var(--space-2);
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  color: var(--muted);
  background-color: transparent;
  border: var(--border-hairline) solid var(--muted);
  border-radius: var(--space-1);
  cursor: pointer;
  opacity: 0;
  transition:
    opacity var(--transition-fast),
    color var(--transition-fast),
    border-color var(--transition-fast),
    background-color var(--transition-fast);
  z-index: var(--z-raised);
}

.code-block:hover .code-copy,
.code-block:focus-within .code-copy {
  opacity: 1;
}

.code-copy:hover {
  color: var(--fg);
  border-color: var(--fg);
  background-color: var(--code-header-bg);
}

.code-copy:focus-visible {
  opacity: 1;
  color: var(--fg);
  border-color: var(--fg);
  background-color: var(--code-header-bg);
  outline: var(--outline-width) solid var(--fg);
  outline-offset: var(--outline-offset-tight);
}

/* ==========================================================================
   6. TRANSFORMER STYLES
   ========================================================================== */

/* --------------------------------------------------------------------------
   Diff - Lines marked with [!code ++] or [!code --]
   -------------------------------------------------------------------------- */

pre.astro-code.has-diff code {
  position: relative;
  padding-left: var(--space-6);
}

pre.astro-code.has-diff .line {
  position: relative;
}

pre.astro-code.has-diff .line.diff {
  margin-left: calc(-1 * (var(--space-6) - var(--space-2)));
  margin-right: calc(-1 * (var(--space-5) - var(--space-2)));
  padding-left: calc(var(--space-6) - var(--space-2));
  padding-right: calc(var(--space-5) - var(--space-2));
}

pre.astro-code .line.diff.add {
  background-color: var(--code-diff-add-bg);
}

pre.astro-code .line.diff.add::before {
  content: '+';
  position: absolute;
  left: var(--space-2);
  color: var(--code-diff-add-symbol);
  font-weight: var(--font-bold);
}

pre.astro-code .line.diff.remove {
  background-color: var(--code-diff-remove-bg);
}

pre.astro-code .line.diff.remove::before {
  content: '-';
  position: absolute;
  left: var(--space-2);
  color: var(--code-diff-remove-symbol);
  font-weight: var(--font-bold);
}

/* --------------------------------------------------------------------------
   Highlight - Lines marked with [!code highlight]
   -------------------------------------------------------------------------- */

pre.astro-code .line.highlighted {
  margin-left: calc(-1 * (var(--space-5) - var(--space-2)));
  margin-right: calc(-1 * (var(--space-5) - var(--space-2)));
  padding-left: calc(var(--space-5) - var(--space-2) - var(--border-thin));
  padding-right: calc(var(--space-5) - var(--space-2));
  background-color: var(--code-highlight-bg);
  border-left: var(--border-thin) solid var(--highlight);
}

pre.astro-code.has-diff .line.highlighted {
  margin-left: calc(-1 * (var(--space-6) - var(--space-2)));
  padding-left: calc(var(--space-6) - var(--space-2) - var(--border-thin));
}

/* --------------------------------------------------------------------------
   Focus - Lines marked with [!code focus]
   -------------------------------------------------------------------------- */

pre.astro-code.has-focused .line:not(.focused) {
  opacity: var(--code-focus-opacity);
  filter: blur(1px);
  transition:
    opacity var(--transition-fast),
    filter var(--transition-fast);
}

pre.astro-code.has-focused:hover .line:not(.focused) {
  opacity: var(--code-focus-hover-opacity);
  filter: blur(0);
}

/* --------------------------------------------------------------------------
   Word Highlight - Words marked with [!code word:term]
   -------------------------------------------------------------------------- */

pre.astro-code .highlighted-word {
  background-color: var(--code-highlight-bg);
  padding: var(--space-05) var(--space-1);
  border-radius: var(--space-1);
  border-bottom: var(--border-hairline) solid var(--highlight);
}

/* ==========================================================================
   7. ACCESSIBILITY
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
  pre.astro-code.has-focused .line:not(.focused) {
    transition: none;
  }

  .code-copy {
    transition: none;
  }
}

@media print {
  .code-copy,
  .code-lang {
    display: none;
  }
}
