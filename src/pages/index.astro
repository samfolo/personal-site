---
/**
 * Home Page
 *
 * Displays hero section and recent blog posts.
 * Fetches posts from content collection.
 */

import Base from '../layouts/Base.astro';
import Hero from '../components/Hero.astro';
import BlogList from '../components/BlogList.astro';
import Boids from '../components/Boids.astro';
import { getCollection } from 'astro:content';

// Fetch published posts from content collection
const allPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

// Sort by publish date and map to BlogList format
const posts = allPosts
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .map((post) => ({
    title: post.data.title,
    date: post.data.publishDate.toISOString(),
    slug: post.id,
  }));
---

<Base title="Sam Folorunsho">
  <Boids />
  <main class="main-content">
    <Hero />
    <section class="blog-section">
      <BlogList posts={posts} />
    </section>
  </main>
</Base>

<style>
  .main-content {
    position: relative;
  }

  .blog-section {
    max-width: var(--container-max);
    margin: 0 auto;
    padding: var(--space-7) var(--container-px) var(--space-9);
  }
</style>
