---
/**
 * Blog Index Page
 *
 * Displays all published blog posts.
 * Uses BlogList component with content collection data.
 */

import {getCollection} from "astro:content";

import {BlogList} from "../../components/blog";
import Prose from "../../layouts/Prose.astro";

// Fetch all non-draft posts (or all posts in development)
const allPosts = await getCollection("blog", ({data}) =>
  import.meta.env.PROD ? !data.draft : true
);

// Sort by publish date (newest first) and map to BlogList format
const posts = allPosts
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .map((post) => ({
    title: post.data.title,
    date: post.data.publishDate.toISOString(),
    slug: post.id,
  }));
---

<Prose
  title="Blog | Sam Folorunsho"
  description="Writing about AI agents, creative coding, and software engineering."
  heading="Blog"
>
  <BlogList slot="before" posts={posts} />
</Prose>
