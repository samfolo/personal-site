---
/**
 * Blog Index Page
 *
 * Displays all published blog posts.
 * Uses BlogList component with content collection data.
 */

import Base from '../../layouts/Base.astro';
import BlogList from '../../components/BlogList.astro';
import { getCollection } from 'astro:content';

// Fetch all non-draft posts (or all posts in development)
const allPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

// Sort by publish date (newest first) and map to BlogList format
const posts = allPosts
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .map((post) => ({
    title: post.data.title,
    date: post.data.publishDate.toISOString(),
    slug: post.id,
  }));
---

<Base title="Blog | Sam Folorunsho" description="Writing about AI agents, creative coding, and software engineering.">
  <main class="blog-index">
    <header class="blog-header">
      <h1 class="blog-title">Blog</h1>
    </header>

    <section class="blog-posts">
      <BlogList posts={posts} />
    </section>
  </main>
</Base>

<style>
  .blog-index {
    max-width: var(--container-max);
    margin: 0 auto;
    padding: var(--space-8) var(--container-px) var(--space-9);
  }

  .blog-header {
    margin-bottom: var(--space-7);
  }

  .blog-title {
    font-size: var(--text-xl);
    font-weight: var(--font-bold);
    letter-spacing: var(--tracking-display);
  }
</style>
