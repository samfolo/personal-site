---
/**
 * FixedFooter Component
 *
 * Fixed footer displaying the current theme name in uppercase.
 * Updates dynamically when theme changes.
 */

import {THEME_LABELS} from "../../config/themes";

import {Overline} from "../typography";
---

<footer
  id="fixed-footer"
  class="fixed-footer"
  transition:persist
  transition:name="footer"
>
  <div class="footer-inner">
    <Overline id="theme-name" class="theme-name"
      >STEEL GREY + WARM CREAM</Overline
    >
  </div>
</footer>

<script is:inline define:vars={{THEME_LABELS}}>
  window.__themeLabels = THEME_LABELS;
</script>

<style>
  .fixed-footer {
    position: fixed;
    bottom: var(--safe-area-bottom);
    left: 0;
    right: 0;
    z-index: var(--z-sticky);
    transition:
      background var(--transition-slow),
      color var(--transition-slow);
    background: linear-gradient(
      in oklab to top,
      var(--bg) 0%,
      var(--bg) 40%,
      color-mix(in oklab, var(--bg) 80%, transparent) 55%,
      color-mix(in oklab, var(--bg) 50%, transparent) 70%,
      color-mix(in oklab, var(--bg) 20%, transparent) 85%,
      transparent 100%
    );
    pointer-events: none;
    padding-top: var(--space-8);
  }

  .footer-inner {
    max-width: var(--container-max);
    margin: 0 auto;
    padding: var(--space-4) var(--container-px);
    display: flex;
    justify-content: flex-end;
  }

  .theme-name {
    pointer-events: auto;
  }
</style>

<script>
  declare global {
    interface Window {
      __themeLabels: Record<string, string>;
    }
  }

  const getThemeLabel = (): string => {
    for (const cls of document.documentElement.classList) {
      if (cls.startsWith("theme-")) {
        const themeId = cls.replace("theme-", "");
        return window.__themeLabels[themeId] || "STEEL GREY + WARM CREAM";
      }
    }
    return "STEEL GREY + WARM CREAM";
  };

  const updateThemeName = (): void => {
    const themeNameEl = document.getElementById("theme-name");
    if (themeNameEl) {
      themeNameEl.textContent = getThemeLabel();
    }
  };

  // Observe html element class changes for theme updates
  const observeThemeChanges = (): void => {
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        if (mutation.attributeName === "class") {
          updateThemeName();
        }
      });
    });

    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ["class"],
    });
  };

  const init = (): void => {
    updateThemeName();
    observeThemeChanges();
  };

  init();
  document.addEventListener("astro:after-swap", init);
</script>
