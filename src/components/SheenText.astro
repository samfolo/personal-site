---
/**
 * SheenText Component
 *
 * Displays text with a left-to-right colour sweep animation on hover.
 * The sheen highlights the centre character with the highlight colour
 * and blends adjacent characters.
 *
 * Characters are split at build time for better performance â€” no DOM
 * manipulation required at runtime.
 *
 * Supports spreading additional attributes (data-*, aria-*, etc.)
 *
 * @param text - The text to display
 * @param tag - The HTML tag to render (default: 'span')
 * @param interval - Animation speed in ms per character (default: 15)
 * @param spread - Number of characters to highlight on each side (default: 2)
 */

interface Props extends astroHTML.JSX.HTMLAttributes {
  text: string;
  tag?: keyof HTMLElementTagNameMap;
  interval?: number;
  spread?: number;
}

const {
  text,
  tag: Tag = 'span',
  class: className,
  interval = 15,
  spread = 2,
  ...attrs
} = Astro.props;

// Split text into words and spaces for server-side rendering
const tokens = text.split(/( )/);
---

<Tag
  class:list={['sheen-text', className]}
  data-sheen-interval={interval}
  data-sheen-spread={spread}
  data-sheen-ready
  {...attrs}
>
  {tokens.map((token) => {
    if (token === ' ') {
      return <span class="sheen-char">&nbsp;</span>;
    }

    if (token.length > 0) {
      return (
        <span class="sheen-word">
          {[...token].map((char) => (
            <span class="sheen-char">{char}</span>
          ))}
        </span>
      );
    }

    return null;
  })}
</Tag>

<script src="../scripts/sheen.ts"></script>

<style>
  .sheen-text :global(.sheen-word) {
    display: inline-block;
    white-space: nowrap;
  }

  .sheen-text :global(.sheen-char) {
    display: inline-block;
    transition: color var(--transition-instant);
  }

  @media (prefers-reduced-motion: reduce) {
    .sheen-text :global(.sheen-char) {
      transition: none;
    }
  }
</style>
