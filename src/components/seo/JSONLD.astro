---
/**
 * JSON-LD Component
 *
 * Provides structured data for search engines:
 * - WebSite schema for general pages
 * - Article schema for blog posts
 */

import {SITE} from "../../config";
import type {
  JSONLDArticle,
  JSONLDArticleData,
  JSONLDPerson,
  JSONLDType,
  JSONLDWebSite,
} from "../../types";

interface Props {
  type: JSONLDType;
  article?: JSONLDArticleData;
}

const {type, article} = Astro.props;

// Canonical URL for article: strip query params
const articleUrl = new URL(Astro.url.pathname, Astro.site ?? SITE.url).href;

const author: JSONLDPerson = {
  "@type": "Person",
  name: SITE.author.name,
  url: SITE.url,
  jobTitle: SITE.author.jobTitle,
  sameAs: [SITE.author.github, SITE.author.linkedin],
};

const schema: JSONLDWebSite | JSONLDArticle =
  type === "Article" && article
    ? {
        "@context": "https://schema.org",
        "@type": "Article",
        headline: article.headline,
        description: article.description,
        url: articleUrl,
        datePublished: article.publishDate.toISOString(),
        dateModified: (
          article.updatedDate ?? article.publishDate
        ).toISOString(),
        author,
        keywords: article.tags?.join(", "),
      }
    : {
        "@context": "https://schema.org",
        "@type": "WebSite",
        name: SITE.name,
        url: SITE.url,
        description: SITE.description,
        author,
      };
---

<script
  is:inline
  type="application/ld+json"
  set:html={JSON.stringify(schema)}
/>
